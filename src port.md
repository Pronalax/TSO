**Src. Port** **(исходящий порт)** — это тот порт, из которого удалённая машина инициирует соединение с нашим роутером.

пускай побудет [[проброс портов]] 

[Маршрутизаторы Mikrotik. Мелочи. Проброс порта. » RouteWorld. Мир маршрутов. Наш мир.](http://routeworld.ru/set-i-internet/web_practice/149-marshrutizatory-mikrotik-melochi-probros-porta.html)

В этой очень короткой статье познакомимся именно с принципом "попадания" извне на некое устройство в сети роутера.

![[Pasted image 20221122032023.png]]

у роутера есть порты 


Имеется вполне себе реальная задача. Есть маршрутизатор линейки CCR за которым висит ряд управляемых свичей. Мы хотим при обращении на определенный порт роутера переадресовываться на конкретный IP в сети для управления извне свичами не имеющими белых айпи и находящихся во внутренней сетке

[[белый айпи]] 
кароч подключиться к компу 

Данная настройка позволяет при обращении на определенный порт вроде _95.215.100.75:8890_ попасть на хост за роутером. Рассмотрим настройки.  
Идем в меню **IP** > **Firewall** > **NAT** и создаем там новое правило. Так выглядит настройка во вкладке **General**

![[Pasted image 20221122032416.png]]

Выбор у нас тут из двух вариантов: srcnat и dstnat. Для простоты понимания поясню, что чейн это что-то вроде направления потока данных. **Srcnat** - из внутренней сети во внешнюю, а **dstnat** - соответственно, из внешней во внутреннюю.

[[srcnat]] 

[[dstnat]]  --- (**destination**)

Тут логика простая, но тут всё зависит от выбранного направления _Chain_. Например, для подключения извне исходный адрес (**source**) будет адресом любого из хостов глобальной сети, а адресом назначение (**destination**) всегда будет внешний адрес роутера. Естественно, из всего этого указать имеет смысл разве что _Dst.Address_.

 # при подключении моего компа к другому компу через маршрутизатор, неважно какой адрес будет использоваться(упрощение проги и вдруг я с другого компа подключусь) , а адрес назначения (**destination**)
всегда будет внешним адресом роутера (провайдер выдает новенький IP-адрес) [[Маршрутизатор]] 

(подключение извне ведь)

-----------------------------------

В поле протокол нужно указать тот, что интересует нас. В 90% случаев нас будет интересовать **tcp(6)**. А указав его, нам становится доступным выбор _Src.Port_ и _Dst.Port_. Напоминаю, мы все еще ведем объяснение приняв, что настраиваем именно _dstnat_!

[[tcp6]] 

**Src. Port** (_исходящий порт_) — это тот порт, из которого удалённая машина инициирует соединение с нашим роутером. Нам это абсолютно без разницы, тут ничего не ставим.

**Dst. Port** (_порт назначения_) — а это как раз тот порт, на который мы хотим принимать соединение. Это может быть, например, заданный в торрент-клиенте порт или порт для доступа к веб-интерфейсу какой-то железки за нашим маршрутизатором.
(то что прописал провайдер)

К слову, ниже идет интересный пункт **Any. Port** (_любой порт_) — так и есть, это объединение двух предыдущих пунктов, тут можно указать значение, которое будет работать и как исходный порт, так и как порт назначения. В целом, нам это не требуется.

----------

**In. interface** (_входящий интерфейс_) — это, грубо говоря, тот интерфейс, на котором _«слушается»_ указанный порт. Если не указан этот параметр, то этот порт перестанет так же быть доступен из внутренней сети, даже несмотря на то, что цепочка у нас _dstnat_. Поэтому, выбираем тут интерфейс, через который мы подключены к интернету, в нашем случае — например,**ether1-gateway** или **sfp1**.  
**Out. interface** (_исходящий интерфейс_) — интерфейс, к которому подключена та машина, на которую мы делаем переадресацию. Тут что-либо ставить не имеет смысла.

------
Указываем логику _dstnat_ и _IP_ назначения, которым будет адрес внешнего интерфейса маршрутизатора. Далее говорим по какому протоколу это будет работать (скорее всего это будет _TCP_) и какой порт мы задействуем.  
И остается настроить вкладку **Action**:

![[Pasted image 20221122034957.png]]

[[netmap]]

![[Pasted image 20221122035558.png]]

Выбираем действие _netmap_ и ссылаемся на нужный нам IP внутренней сети. Чтобы правило не перестало работать, IP должен быть статическим. Ну, и указываем, на какой порт долбиться. Собственно, вот и вся настройка.  
  

### --------------------------------------

  
Есть второй вариант реализации правила NAT для проброса порта, и будет выглядеть он следующим образом:
[[NAT]] 

![[Pasted image 20221122035918.png]]


То есть всё также выбираем цепочку **dstnat**, указываем нужный протокол и порт назначения, а также интерфейс с которого мы ожидаем увидеть пакетики подпадающие под правило. Ну, а вкладка **Action** настраивается всё также.  
Разница, как можно заметить, в том, что в первом рассматриваемом нами случае критерием для выбора пакетика будет destination address, который тождественен IP-адресу внешнего интерфейса роутера, а также нужный нам порт назначения. Во втором случае правило несколько более универсально, ведь его не придется редактировать в случае изменения внешнего айпишника - оно просто продолжит свою работу.
